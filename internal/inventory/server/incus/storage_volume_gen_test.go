// Code generated by generate-inventory; DO NOT EDIT.

package incus_test

import (
	"context"
	"net/http"
	"testing"

	incusapi "github.com/lxc/incus/v6/shared/api"
	"github.com/stretchr/testify/require"

	"github.com/FuturFusion/operations-center/internal/inventory"
	"github.com/FuturFusion/operations-center/internal/provisioning"
	"github.com/FuturFusion/operations-center/internal/util/testing/queue"
	"github.com/FuturFusion/operations-center/shared/api"
)

func storageVolumeClientTestCases(t *testing.T) []methodTestSet {
	return []methodTestSet{
		{
			name: "GetStorageVolumes",
			clientCall: func(ctx context.Context, client inventory.ServerClient, endpoint provisioning.Endpoint) (any, error) {
				return client.GetStorageVolumes(ctx, endpoint, "storage_pool")
			},
			testCases: []methodTestCase{
				{
					name: "success",
					response: []queue.Item[response]{
						{
							Value: response{
								statusCode: http.StatusOK,
								responseBody: mustJSONMarshal(t, api.ResponseRaw{
									Metadata: []incusapi.StorageVolumeFull{
										{
											StorageVolume: incusapi.StorageVolume{
												Name:     "storageVolume one",
												Location: "one",
												Project:  "project one",
											},
										},
									},
								}),
							},
						},
					},

					assertErr: require.NoError,
					assertResult: func(t *testing.T, res any) {
						t.Helper()
						require.Len(t, res, 1)
					},
					wantPaths: []string{"GET /1.0/storage-pools/storage_pool/volumes?all-projects=true"},
				},
				{
					name: "error - not found",
					response: []queue.Item[response]{
						{
							Value: response{
								statusCode: http.StatusNotFound,
								responseBody: mustJSONMarshal(t, api.ResponseRaw{
									Type:       api.ErrorResponse,
									StatusCode: http.StatusNotFound,
								},
								),
							},
						},
					},

					assertErr:    require.Error,
					assertResult: noResult,
					wantPaths:    []string{"GET /1.0/storage-pools/storage_pool/volumes?all-projects=true"},
				},
				{
					name: "error - unexpected http status code",
					response: []queue.Item[response]{
						{
							Value: response{
								statusCode: http.StatusInternalServerError,
							},
						},
					},

					assertErr:    require.Error,
					assertResult: noResult,
					wantPaths:    []string{"GET /1.0/storage-pools/storage_pool/volumes?all-projects=true"},
				},
			},
		},

		{
			name: "GetStorageVolumeByName",
			clientCall: func(ctx context.Context, client inventory.ServerClient, endpoint provisioning.Endpoint) (any, error) {
				return client.GetStorageVolumeByName(ctx, endpoint, "project", "storage_pool", "name", "custom")
			},
			testCases: []methodTestCase{
				{
					name: "success",
					response: []queue.Item[response]{
						{
							Value: response{
								statusCode: http.StatusOK,
								responseBody: mustJSONMarshal(t, api.ResponseRaw{
									Metadata: incusapi.StorageVolumeFull{
										StorageVolume: incusapi.StorageVolume{
											Name:     "storageVolume one",
											Location: "one",
											Project:  "project one",
										},
									},
								}),
							},
						},
					},

					assertErr: require.NoError,
					assertResult: func(t *testing.T, res any) {
						t.Helper()

						wantStorageVolume := incusapi.StorageVolumeFull{
							StorageVolume: incusapi.StorageVolume{
								Name:     "storageVolume one",
								Location: "one",
								Project:  "project one",
							},
						}

						require.Equal(t, wantStorageVolume, res)
					},
					wantPaths: []string{"GET /1.0/storage-pools/storage_pool/volumes/custom/name?project=project"},
				},
				{
					name: "error - unexpected http status code",
					response: []queue.Item[response]{
						{
							Value: response{
								statusCode: http.StatusInternalServerError,
							},
						},
					},

					assertErr:    require.Error,
					assertResult: noResult,
					wantPaths:    []string{"GET /1.0/storage-pools/storage_pool/volumes/custom/name?project=project"},
				},
				{
					name: "error - not found",
					response: []queue.Item[response]{
						{
							Value: response{
								statusCode: http.StatusNotFound,
								responseBody: mustJSONMarshal(t, api.ResponseRaw{
									Type:   api.ErrorResponse,
									Status: http.StatusText(http.StatusNotFound),
								}),
							},
						},
					},

					assertErr:    require.Error,
					assertResult: noResult,
					wantPaths:    []string{"GET /1.0/storage-pools/storage_pool/volumes/custom/name?project=project"},
				},
			},
		},
	}
}
