// Code generated by generate-database from the incus project - DO NOT EDIT.

package entities

import (
	"context"
	"database/sql"
	"errors"
	"fmt"
)

var clusterObjects = RegisterStmt(`
SELECT clusters.id, clusters.name, clusters.connection_url, clusters.certificate, clusters.status, channels.name AS channel, clusters.last_updated
  FROM clusters
  JOIN channels ON clusters.channel_id = channels.id
  ORDER BY clusters.name
`)

var clusterID = RegisterStmt(`
SELECT clusters.id FROM clusters
  WHERE clusters.name = ?
`)

// GetClusterID return the ID of the cluster with the given key.
// generator: cluster ID
func GetClusterID(ctx context.Context, db tx, name string) (_ int64, _err error) {
	defer func() {
		_err = mapErr(_err, "Cluster")
	}()

	stmt, err := Stmt(db, clusterID)
	if err != nil {
		return -1, fmt.Errorf("Failed to get \"clusterID\" prepared statement: %w", err)
	}

	row := stmt.QueryRowContext(ctx, name)
	var id int64
	err = row.Scan(&id)
	if errors.Is(err, sql.ErrNoRows) {
		return -1, ErrNotFound
	}

	if err != nil {
		return -1, fmt.Errorf("Failed to get \"clusters\" ID: %w", err)
	}

	return id, nil
}
