// Code generated by generate-database from the incus project - DO NOT EDIT.

package entities

import (
	"context"
	"database/sql"
	"errors"
	"fmt"
)

var serverObjects = RegisterStmt(`
SELECT servers.id, clusters.name AS cluster, servers.name, servers.type, servers.connection_url, servers.public_connection_url, servers.certificate, clusters.certificate AS cluster_certificate, clusters.connection_url AS cluster_connection_url, servers.hardware_data, servers.os_data, servers.version_data, servers.status, servers.last_updated, servers.last_seen
  FROM servers
  LEFT JOIN clusters ON servers.cluster_id = clusters.id
  ORDER BY servers.name
`)

var serverID = RegisterStmt(`
SELECT servers.id FROM servers
  WHERE servers.name = ?
`)

// GetServerID return the ID of the server with the given key.
// generator: server ID
func GetServerID(ctx context.Context, db tx, name string) (_ int64, _err error) {
	defer func() {
		_err = mapErr(_err, "Server")
	}()

	stmt, err := Stmt(db, serverID)
	if err != nil {
		return -1, fmt.Errorf("Failed to get \"serverID\" prepared statement: %w", err)
	}

	row := stmt.QueryRowContext(ctx, name)
	var id int64
	err = row.Scan(&id)
	if errors.Is(err, sql.ErrNoRows) {
		return -1, ErrNotFound
	}

	if err != nil {
		return -1, fmt.Errorf("Failed to get \"servers\" ID: %w", err)
	}

	return id, nil
}
